### 젠킨스 컨테이너 설정

젠킨스 컨테이너에 `docker.sock`을 연결해주고, 내부에 도커엔진과 도커 컴포즈를 설치한 뒤 root로 실행했다.

도커 컴포즈만 설치해도 실행된다는 이야기가 있던데, 확인해봐야 할 것 같다.

### Nginx 컨테이너에 SSL 설정하기

도커 컴포즈로 해결하는 코드가 보였지만, 설명이 없어서 하기 싫었다.

글마다 설명이 하나도 없어서 임의로 세팅하기가 싫었고, 그냥 로컬에 엔진엑스 설치하고 certbot으로 SSL을 자동으로 설정했다.

### 스프링부트 컨테이너에서 MySQL 컨테이너를 접속하지 못하는 오류

우선 컨테이너끼리 통신하려면, 해당 컨테이너명으로 URL을 작성해야 했다.

그리고, 연결하려는 DB가 존재하지 않으면 제대로 연결하지 못했다. DB가 없으면 생성하는 파라미터를 추가했고, `application-dev.yml`을 따로 작성해서 개발 서버용 설정 파일을 작성했다.

이후 빌드하여 실행하니 정상적으로 접속이 되었다.

### 엔진엑스에서, 젠킨스 서버는 `/jenkins` 로 접속하도록 하는 것이 가능한가?

가능은 하지만, 로그인 페이지로 리다이렉트 할 때 `/` 로 다시 이동하는 등의 문제가 발생했다. 애초에 NGINX는 그런 용도로 만든 게 아니었다.

도메인을 새로 연결해서 세팅하면 가능할 것 같다.

### 엔진엑스를 이용해서 테스트 서버와 릴리즈 서버를 분리하기

위와 동일한 이유로 파기.

### 도커파일에서 여러 스테이지 활용하기

도커파일에서 FROM을 여러 개 써서 한 번에 이미지를 만드는 게 가능하다는 걸 알게 되었다. gradle 이미지로 빌드 후 openjdk-slim으로 실행하는 멋진 코드를 봤다.

그래서 그를 참고하여 도커파일을 새로 작성하였다.

[참고](https://wolfy.tistory.com/302)

### 리액트 빌드 후 배포하기

이걸 리액트 서버로 배포할 건지 아니면 빌드 후 Nginx에 정적으로 배포할 건지 고민했는데, 리액트 전용 Nginx 컨테이너를 추가로 띄우기로 결정했다.

백엔드 서버 접속을 어떻게 처리할지 고민했는데, 애초에 사용하는 클라이언트가 서버 밖에 있어서, 서버 URL을 가리키게 하면 됐다.

### CORS 해결하기

Nginx는 단순 프록시 역할만 하므로 CORS와는 관련이 없다.

스프링부트와 스프링 시큐리티를 같이 쓰고 있는데, 스프링 시큐리티가 필터 단에서, 스프링부트가 서블릿 즈음에서 처리할 것이라고 생각하고 둘 다 설정을 해 뒀다.

### JPA 세션 만료 문제

스프링부트 서비스 단에서 `@Transactional`을 붙여주면 해결된다.